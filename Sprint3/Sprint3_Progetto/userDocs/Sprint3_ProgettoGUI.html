<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<head>
	<!--
<link rel="stylesheet" type="text/css" href="../css/issStyle1.css">
<script type="text/javascript" src="../css/issStyle.js"></script>
-->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/foundation-sites@6.7.4/dist/css/foundation.min.css"
		crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/foundation-sites@6.7.4/dist/js/foundation.min.js"
		crossorigin="anonymous"></script>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="./commons/resources/styles/templateISS.css">
	<link rel="stylesheet" type="text/css" href="./commons/resources/styles/main.css">
	<link rel="stylesheet" type="text/css" href="./commons/resources/styles/navbar.css">
	<link rel="stylesheet" type="text/css" href="./commons/resources/styles/table.css">
	<link rel="stylesheet" type="text/css" href="./commons/resources/styles/code.css">

	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap"
		rel="stylesheet">

	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap"
		rel="stylesheet">

	<!-- <script type="text/javascript" src="./commons/resources/scripts/myScripts.js"></script> -->
	<style type="text/css">
		body {
			margin: auto;
			max-width: 1300px;
			font-family: "Open Sans", sans-serif;
			font-optical-sizing: auto;
		}

		body {
			font-family: "Rubik" !important;
			font-optical-sizing: auto;
		}

		P {}

		;

		a,
		a:visited,
		a:active,
		a:link,
		a:hover {
			text-decoration: underline;
			color: #545454;
			background-color: transparent;
			font-size: 93%;
		}

		a:hover {
			background-color: #cccccc;
		}


		hr {
			clear: both;
			height: 1px;
			color: #242424;
			background-color: transparent;
		}

		h1,
		h2,
		h3 {
			color: #242424;
			clear: left;
			font: 100% Tahoma, Helvetica, Arial, sans-serif;
			margin-top: 1em;
			padding-top: 0.5em;
			border-radius: 10px;
			padding: 5px;
		}

		top {
			width: 100%;
		}


		#i {
			color: #ff1010;
		}

		tt {
			font-family: "Arial";
			font-size: 90%;
			color: #006600;
		}

		em {
			font-family: "Arial";
			font-size: 80%;
			font-weight: bold;
			border-style: solid;
			border-color: #abe876;
			color: #1632cc;
		}

		bc {
			font-family: "Arial";
			font-size: 90%;
			font-weight: bold;
			color: #990000;
			background-color: #fcf8c7;
		}

		ks {
			font-family: "Arial";
			font-weight: bold;
			color: #0000CD;
			font-size: 90%;
		}

		kc {
			font-family: "Arial";
			font-weight: bold;
			color: #008000;
			font-size: 90%;
		}

		todo {
			background-color: #FFFF00 !important
		}

		todo:before {
			content: "TODO:";
			font-weight: bold;
		}

		red {
			color: #fa2929;
			font-weight: bold;
		}

		pre {
			font-family: "Consolas";
			font-size: 85%;
			background-color: #f5f5f5;
			border: 1.5px solid silver;
			padding: 5px;
		}

		m {
			font-family: "Helvetica";
			line-height: 100%;
			font-size: 75%;
		}

		div.body {

			font-size: 18px;
		}

		k {
			color: #990000;
			font-weight: bold;
			font-size: 90%;
		}

		h1 {
			font-size: 150%;
			background-color: #b2c0ff;
			padding: 10px;
		}

		h2 {
			background-color: #9ed8ff;
			font-size: 130%;
		}

		h3 {
			background-color: #e6ccff;
			font-size: 100%;
		}

		h4 {
			background-color: #ccffcc;
			font-size: 100%;
			width: 95%;
			border-radius: 5px;
			padding: 2px;
		}

		h5 {
			background-color: #d5ffb0;
			font-size: 100%;

		}

		div.req {
			background-color: #d9ffb3;
			font-size: 18px;
			width: 700px;
			border: 3px solid green;
			padding: 15px;
			margin: 10px;
		}

		div.remark {
			background-color: #E3F2FD;
			border: 1.5px solid #d5f2ed;
			padding: 15px;
			margin: 10px;
			border-radius: 15px;
		}

		table,
		th,
		td {
			border: 1px solid black;
			border-collapse: collapse;
			text-align: center;
		}

		td.disp {
			background-color: #7b7bff;
			color: white;
		}

		td.update {
			background-color: rgb(151, 113, 254);
			color: white;
		}

		td.event {
			background-color: rgb(47, 255, 106);
			color: #242424;
		}

		ol,
		ul,
		li {
			margin: 0;
			margin-left: 25px;
			padding: 0;
			padding-bottom: 5px;
		}

		table,
		th,
		td {
			border: 1px solid black;
		}

		table {
			table-layout: auto !important;
		}

		img {
			border: 1.5px solid #d5f2ed
		}

		a,
		a:visited,
		a:active,
		a:link,
		a:hover {
			text-decoration: underline;
			color: #545454;
			background-color: transparent;
		}

		div.wrapdesc {
			width: 90%;
			margin: auto;
		}

		msg {
			color: #ff1010;
		}

		div.imagedesc {
			width: 85%;
			margin: auto;
		}

		pre {
			background: #f4f4f4;
			border: 1px solid #ddd;
			color: rgb(0, 0, 0);
			page-break-inside: avoid;
			font-family: monospace;
			font-size: 15px;
			line-height: 1.3;
			margin-bottom: 1em;
			max-width: 100%;
			overflow: auto;
			display: block;
			word-wrap: break-word;
		}
	</style>


	<script>
		window.onload = () => {
			console.log(words)
			for (let i = 0; i < words.length; i++) {
				const word = words[i]
				addLinks(word.text, word.link)
			}
		}

		function addLinks(word, link) {
			if (window.find) {
				while (window.find(word, false)) {
					var range = window.getSelection().getRangeAt(0);

					const node = document.createElement('a')
					node.setAttribute("href", link)
					node.innerText = word

					range.deleteContents();
					range.insertNode(node);
				}
			}
		}

		var words = [
			{ text: 'CleanArchitecture', link: '../../../resources/Architetture.html#la-clean-architecture' },
			{ text: 'Spring Boot', link: 'https://spring.io/projects/spring-boot' },
			{ text: 'Facade24Start', link: '../resources/Facade24Start.html' },
			{ text: 'ActorOutIn', link: '../resources/Facade24Start.html#actoroutin' }
		]

	</script>

</head>






<title>Sprint 3</title>
</head>

<!--
	<body onload="loadNav();">
		<div id="openButton" class="openButton" onclick="openNav(true)">&#9776; Menu</div>
		<div id="sidenav" class="sidenav">
			<a class="closeButton" href="javascript:void(0)" onclick="closeNav(true)">&times;</a>
			<a href=".README.html">ReadMe</a>
			<a class="sprint" href="../../../Sprint0/Codice/userDocs/Cold%20Storage%20Service%20-%20Natali%20V3.html">Sprint0</a>
			<a class="sprint" href="../../../Sprint1.0/Codice/userDocs/Sprint%201.0%20-%20V3.html">Sprint1.0</a>
			<a class="sprint" href="../../../Sprint1.1/Codice/userDocs/Sprint%201.1%20-%20V3.html">Sprint1.1</a>
			<a id="currentSprint" class="sprint" href="#">&#8211;&#8212; Sprint2 &#8212;&#8211;</a>
			<div class="sidenavSection">
				<a href="#Goal Sprint 2">Goal Sprint 2</a>
				<a href="#Requisiti">Requisiti</a>
				<a href="#Analisi dei Requisiti">Analisi dei Requisiti</a>
				<a href="#Analisi del Problema">Analisi del Problema</a>
				<a href="#Test Plan">Test Plan</a>
				<a href="#Progettazione">Progettazione</a>
				<a href="#Deployment">Deployment</a>
			</div>
			<p class="separator">&mdash;&mdash;&mdash;&ndash;&ndash;&mdash;&mdash;&mdash;</p>
			<a class="sprint" href="../../../Sprint3/Codice/userDoc/Sprint%203.html">Sprint3</a>
			<bottom-spacer/>
		</div>
-->

<body background="">
	<div id="top">
		<h1>Waste Incinerator Service - ISS 2024 <font size="5"></font>
		</h1>
	</div>

	<div class="body">
		<h2>Architettura Logica</h2>
		<todo>Immagine architettura
		</todo>
		<h2>Progetto</h2>
		Come accennato nell'analisi del problema, si è realizzata una WEB-GUI. Per progettarla è stato utilizzato Spring
		Boot. <br>
		Il progetto della GUI si divide in due parti:
		<ul>
			<li>
				<b>Parte statica</b>: l'impostazione della pagina HTML.
			</li>
			<li>
				<b>Parte dinamica</b>: permette all’applicazione Web di interagire da un lato con utente umano e da un
				altro lato con una applicazione qak.
			</li>
		</ul>
		<h3>Parte Statica</h3>
		<img src="../../../resources/gui.PNG" alt="">
		<a href=".././../sprint3_progetto_ssgui/src/main/resources/templates/SSGUI.html">SSGUI.html</a>
		<br>
		<br>
		Inoltre, nel file <a
			href=".././../sprint3_progetto_ssgui/src/main/resources/static/wsminimal.js">wsminimal.js</a> sono state
		inserite le funzioni che permettono di aggiornare i valori sull'interfaccia, così come le funzioni per
		aggiungere un RP e prelevare la cenere.

		<h3>Parte dinamica</h3>
		Per la parte dinamica sono stati riutilizzati alcuni componenti del progetto Facade24Start poichè ritenuti
		adeguati. Quelli che è stato necessario adattare al <b>WIS</b> sono:
		<br>
		<br>
		<h4>ActorOutIn</h4>
		Crea la connessione TCP all’attore del sistema applicativo<br>
		Esso viene utilizzato per 2 tipi di interazioni:
		<ol>
			<li>Aggiornare la WEB-GUI con i valori corretti del sistema attuale, inviando a tutte le GUI le informazioni
				aggiornate tramite il WSHandler </li>
			<pre>
	public void sendToOne(IApplMessage msg) {
		wsHandler.sendToOne(msg);
	}

	public void sendToOne(String msg) {
		wsHandler.sendToOne(msg);
	}

	public void sendToAll(String msg) {
		wsHandler.sendToAll(msg);
	}
			</pre>
			<li>Realizzare i comandi per il Mock, le funzioni di inserimento e prelievo di un RP su decisione
				dell'utente ( funzioni non da requisiti, solo per testing )</li>
			<pre>
	public void docmd( IApplMessage message ) {
		CommUtils.outmagenta("OUTIN | docmd message=" + message );
		sendToActor( message );
	}
	
	private void sendToActor(IApplMessage message ) {
		String response = this.sendApplMsg(message);
	}
			</pre>
		</ol>
		<h4>ApplGuiCore</h4>
		Rappresenta il core business della GUI. Ha la responsabilità di decidere cosa fare per ogni messaggio di input e
		come inviare informazioni in uscita attraverso l’adapter ActorOutIn.<br>
		Utilizzato per gestire le richieste provenienti dal Mock<br>
		<pre>
	public void handleWsMsg(String id, String msg) {
		CommUtils.outcyan("AGC | handleWsMsg msg " + msg  );
		JSONObject jsonMsg = new JSONObject(msg);
		boolean isCmd = jsonMsg.has("cmd");
		if(jsonMsg.has("mock_deposit")){
			IApplMessage message = CommUtils.buildDispatch("gui23xyz9526", "mock_deposit", "mock_deposit(1)" , "wis");
			outinadapter.docmd( message );
			return;
		}
		else if(jsonMsg.has("mock_remove")){
			IApplMessage message = CommUtils.buildDispatch("gui23xyz9526", "mock_remove", "mock_remove(1)" , "wis");
			outinadapter.docmd( message );
			return;
		}
	}
		</pre>

		<h3>Interazioni</h3>
		<h4>OpRobot &rarr; Wis </h4>
		Dato che la GUI deve mostrare la posizione ed il lavoro corrente di <b>OpRobot</b>, è necessario che queste
		informazioni vengano inviate al <b>Wis</b>. Per questo motivo è stato aggiunto il messaggio: <br>
		<center><i>robot_info: robot_info(X,Y,POSITION,JOB)</i></center>

		<h4>Wis &rarr; GUI </h4>
		Per aggiornare la GUI affinchè rispecchi i cambiamenti dl sistema, è stato necessario introdurre un nuovo
		messaggio: <br>
		<center><i>guidata: guidata(WASTE_QTY,ASH_LEVEL,ISBURNING,X,Y,POSITION,JOB)</i></center>
		<br>
		Ogni volta che uno dei dati all'interno del messaggio cambia, il <a
			href="../../../Sprint3/sprint3_progetto_ssgui/src/main/java/sprint3_progetto_ssgui/CoapObserver.java">CoapObserver</a>
		cattura l'updateResource inviato dal <b>Wis</b>.
		<br>

		<h3>Mock</h3>
		L'attore Mock che a cicli di tempo predefiniti andava ad inserire/prelevare RP dai due storage è stato
		rimosso.<br>
		Per semplicità, l'entità esterna che si occupa del deposito di RP e del prelievo di cenere viene simulata
		tramite la pressione di due bottoni sulla GUI. A questo punto, ActorOutIn confeziona un IApplMessage msg e
		chiama sendToActor(IApplMessage message)

		<h2>Deployment</h2>
		Per il deployment del progetto, sono state inserite le seguenti linee di codice nel file <a
			href="../../Sprint3_Progetto/src/core_business.qak">corebusiness.qak</a>
		<pre>
	Facade robotfacade port 8060 usingactor wis inctx ctx_wis  
        appl "main.java.sprint3_progetto_ssgui.Sprint3ProgettoSsguiApplication" 
		UserLibs -f "sprint3_progetto_ssgui-1.0-plain" -f "sprint3_progetto_ssgui-1.0"
		</pre>
		Che permette di avviare la GUI assieme al Core Business.  <br>
		Inoltre, i due jar "sprint3_progetto_ssgui-1.0-plain" e "sprint3_progetto_ssgui-1.0", sono stati creati dopo aver
		eseguito il comando:
			<pre>	gradlew distZip</pre>
		nella directory della gui ed aggiungerli ad <a href="../../unibolibs/">unibolibs</a>.
		<br>
		<br>
		A questo punto, come nello sprint precedente, si vanno a creare i file <b>wis.bat</b> e
		<b>monitoringdevice.bat</b> tramite i comandi:
		<pre>	gradlew distZip 
	gradlew distZip -Pbuild_MD</pre>
		Quest'ultimo verrà eseguito dal RaspberryPI.
		<br>
		Infine è necessario avviare il file <a href="../../../unibo.basicrobot24/basicRobot.bat">basicRobot.bat</a> che
		avvia l'immagine docker del WEnv ed
		imposta la stanza impostata nel file sceneConfig.js.
			<br>
			<br>
		<div style="background-color:rgba(86, 56, 253, 0.9); width:60%;text-align:left;color:white">
			By Alessandro Piombini & Danilo Cavallini
			<br>
			Email:
			<ul>
				<li>
					alessandro.piombini@studio.unibo.it
				</li>
				<li>
					danilo.cavallini@studio.unibo.it
				</li>
			</ul>
			GIT repo: https://github.com/Piombo4/ISS2024-WIS
			<br>

		</div>
</body>

</html>